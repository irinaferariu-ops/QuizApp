using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Threading;
using Newtonsoft.Json;

namespace QuizApp2
{
    public class Program
    {
        // Speichere Scores im Benutzer-AppData-Ordner
        static string ScoresFile
        {
            get
            {
                var appData = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);
                var dir = Path.Combine(appData, "QuizApp2");
                if (!Directory.Exists(dir)) Directory.CreateDirectory(dir);
                return Path.Combine(dir, "scores.json");
            }
        }

        static void Main(string[] args)
        {
            Console.OutputEncoding = System.Text.Encoding.UTF8;
            ZeigeHeader();
            var scores = LadeScores();

            while (true)
            {
                ZeigeHauptmenue();
                var auswahl = Console.ReadLine()?.Trim() ?? string.Empty;

                if (auswahl == "1")
                {
                    // Quiz mit Pomodoro (Lernmodus)
                    var benutzer = SammleBenutzerDaten();
                    StarteQuizMitPomodoro(benutzer);
                    scores.Add(benutzer);
                    SpeichereScores(scores);
                    Console.WriteLine("\nâœ… Ergebnis gespeichert!");
                    PauseUndLoesche();
                }
                else if (auswahl == "2")
                {
                    // Quiz Examen (1,5 Stunden)
                    var benutzer = SammleBenutzerDaten();
                    StarteExamenQuiz(benutzer);
                    scores.Add(benutzer);
                    SpeichereScores(scores);
                    Console.WriteLine("\nâœ… Ergebnis gespeichert!");
                    PauseUndLoesche();
                }
                else if (auswahl == "3")
                {
                    ZeigeHighscores(scores);
                    PauseUndLoesche();
                }
                else if (auswahl == "4")
                {
                    Console.WriteLine("\nğŸ‘‹ Auf Wiedersehen! Viel Erfolg bei deiner PrÃ¼fung!");
                    break;
                }
                else
                {
                    Console.ForegroundColor = ConsoleColor.Red;
                    Console.WriteLine("âŒ UngÃ¼ltige Auswahl! Bitte wÃ¤hle 1-4.");
                    Console.ResetColor();
                }
            }
        }

        static void ZeigeHeader()
        {
            Console.Clear();
            Console.ForegroundColor = ConsoleColor.Cyan;
            Console.WriteLine("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
            Console.WriteLine("â•‘   ğŸ“ QuizApp - PrÃ¼fungssimulation ğŸ“     â•‘");
            Console.WriteLine("â•‘     Projektmanagement - Lernmodus         â•‘");
            Console.WriteLine("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
            Console.ResetColor();
        }

        static void ZeigeHauptmenue()
        {
            Console.WriteLine("\nğŸ“‹ HauptmenÃ¼:");
            Console.WriteLine("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
            Console.WriteLine("1ï¸âƒ£  ğŸ“š Quiz mit Pomodoro (Lernmodus mit Pausen)");
            Console.WriteLine("2ï¸âƒ£  ğŸ“ Quiz Examen (1,5 Std - PrÃ¼fungssimulation)");
            Console.WriteLine("3ï¸âƒ£  ï¿½ Highscores anzeigen");
            Console.WriteLine("4ï¸âƒ£  ğŸšª Beenden");
            Console.WriteLine("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
            Console.Write("â¡ï¸  Deine Auswahl: ");
        }

        static Benutzer SammleBenutzerDaten()
        {
            Console.ForegroundColor = ConsoleColor.Cyan;
            Console.Write("\nğŸ‘¤ Bitte gib deinen Namen ein: ");
            Console.ResetColor();
            string name = Console.ReadLine() ?? string.Empty;

            Console.ForegroundColor = ConsoleColor.Cyan;
            Console.Write("ğŸ™ï¸  Stadt: ");
            Console.ResetColor();
            string stadt = Console.ReadLine() ?? string.Empty;

            string datum = DateTime.Now.ToString("dd.MM.yyyy");

            Console.WriteLine("\nğŸ“˜ Welches Niveau mÃ¶chtest du prÃ¼fen?");
            Console.WriteLine("   1ï¸âƒ£  Basiszertifizierung");
            Console.WriteLine("   2ï¸âƒ£  Level D");
            Console.WriteLine("   3ï¸âƒ£  Level C");
            Console.ForegroundColor = ConsoleColor.Cyan;
            Console.Write("â¡ï¸  Deine Auswahl (1-3): ");
            Console.ResetColor();
            string niveau = Console.ReadLine() ?? string.Empty;

            return new Benutzer(name, stadt, datum, niveau);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ“š QUIZ MIT POMODORO: Lernen mit Pausen alle 25 Minuten
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        static void StarteQuizMitPomodoro(Benutzer benutzer)
        {
            try
            {
                string basePath = AppDomain.CurrentDomain.BaseDirectory;
                string pfad = Path.Combine(basePath, "question.json");
                
                Console.WriteLine($"\nğŸ” Lade Fragen aus: {pfad}");
                List<Frage> fragen = JsonConvert.DeserializeObject<List<Frage>>(File.ReadAllText(pfad)) ?? new List<Frage>();
                
                double punktzahl = 0.0;
                int frageNummer = 1;
                DateTime startZeit = DateTime.Now;
                DateTime naechstePause = startZeit.AddMinutes(25);

                Console.ForegroundColor = ConsoleColor.Green;
                Console.WriteLine("\nğŸ… â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
                Console.WriteLine("   POMODORO-LERNMODUS AKTIVIERT!");
                Console.WriteLine("   Alle 25 Minuten: 5 Min Pause");
                Console.WriteLine("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
                Console.ResetColor();

                foreach (var frage in fragen)
                {
                    // PrÃ¼fe, ob Pausenzeit erreicht ist
                    if (DateTime.Now >= naechstePause)
                    {
                        SpieleSignalTon();
                        Console.ForegroundColor = ConsoleColor.Yellow;
                        Console.WriteLine("\n\nâ˜• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
                        Console.WriteLine("   â° PAUSENZEIT! 5 Minuten Pause");
                        Console.WriteLine("   ğŸ’† Steh auf, trink Wasser, entspanne dich!");
                        Console.WriteLine("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
                        Console.ResetColor();
                        
                        if (!LasseTimerLaufen(5 * 60, "PAUSE"))
                            return;
                        
                        SpieleSignalTon();
                        Console.ForegroundColor = ConsoleColor.Green;
                        Console.WriteLine("\nâœ… Pause beendet! Weiter geht's mit dem Lernen!");
                        Console.ResetColor();
                        
                        naechstePause = DateTime.Now.AddMinutes(25);
                    }

                    // Zeige Frage
                    Console.WriteLine($"\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
                    Console.ForegroundColor = ConsoleColor.Yellow;
                    Console.WriteLine($"ğŸ“ Frage {frageNummer}/{fragen.Count}:");
                    Console.ResetColor();
                    Console.WriteLine(frage.FrageText);

                    if (frage.Typ == "MultipleChoice")
                    {
                        for (int i = 0; i < frage.Antworten.Count; i++)
                        {
                            Console.WriteLine($"   {i + 1}) {frage.Antworten[i]}");
                        }
                        
                        Console.Write("\nâ¡ï¸  Deine Antwort (z.B. 1 oder 1,2): ");
                        var eingabe = Console.ReadLine() ?? string.Empty;

                        var antworten = eingabe.Split(',', StringSplitOptions.RemoveEmptyEntries)
                            .Select(s => int.TryParse(s.Trim(), out int val) ? val - 1 : -1)
                            .Where(i => i >= 0)
                            .ToList();

                        if (PruefeMultipleChoice(frage, antworten))
                        {
                            Console.ForegroundColor = ConsoleColor.Green;
                            Console.WriteLine("âœ… Richtig!");
                            Console.ResetColor();
                            punktzahl++;
                        }
                        else
                        {
                            Console.ForegroundColor = ConsoleColor.Red;
                            Console.WriteLine("âŒ Falsch!");
                            Console.ResetColor();
                            Console.WriteLine("âœ”ï¸  Richtige Antwort(en): " + 
                                string.Join(", ", frage.RichtigeAntworten.Select(i => (i + 1).ToString())));
                        }
                    }
                    else if (frage.Typ == "Offen")
                    {
                        Console.Write("\nâœï¸  Deine Antwort: ");
                        var userAntwort = Console.ReadLine() ?? string.Empty;
                        double score = PruefeOffeneFrage(userAntwort, frage.RichtigeAntwort);

                        if (score >= 0.8)
                        {
                            Console.ForegroundColor = ConsoleColor.Green;
                            Console.WriteLine("âœ… VollstÃ¤ndig korrekt!");
                            Console.ResetColor();
                            punktzahl++;
                        }
                        else if (score >= 0.5)
                        {
                            Console.ForegroundColor = ConsoleColor.Yellow;
                            Console.WriteLine("ğŸŸ¡ Teilweise korrekt (0.5 Punkte).");
                            Console.ResetColor();
                            punktzahl += 0.5;
                        }
                        else
                        {
                            Console.ForegroundColor = ConsoleColor.Red;
                            Console.WriteLine("âŒ Leider falsch.");
                            Console.ResetColor();
                            Console.WriteLine("ğŸ’¡ Erwartete SchlÃ¼sselbegriffe: " + frage.RichtigeAntwort);
                        }
                    }

                    frageNummer++;
                }

                benutzer.Punktestand = punktzahl;
                TimeSpan gesamtZeit = DateTime.Now - startZeit;
                
                Console.WriteLine("\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
                Console.ForegroundColor = ConsoleColor.Cyan;
                Console.WriteLine($"ğŸ Quiz beendet! {benutzer.Name}, du hast {punktzahl:0.0} von {fragen.Count} Punkten erreicht.");
                Console.WriteLine($"â±ï¸  Gesamtzeit: {gesamtZeit.Hours}h {gesamtZeit.Minutes}min");
                Console.ResetColor();
            }
            catch (Exception ex)
            {
                Console.ForegroundColor = ConsoleColor.Red;
                Console.WriteLine($"âŒ Fehler beim Laden der Fragen: {ex.Message}");
                Console.ResetColor();
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ“ EXAMEN-QUIZ: 1,5 Stunden PrÃ¼fungssimulation
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        static void StarteExamenQuiz(Benutzer benutzer)
        {
            try
            {
                string basePath = AppDomain.CurrentDomain.BaseDirectory;
                string pfad = Path.Combine(basePath, "question.json");
                
                Console.WriteLine($"\nğŸ” Lade Fragen aus: {pfad}");
                List<Frage> fragen = JsonConvert.DeserializeObject<List<Frage>>(File.ReadAllText(pfad)) ?? new List<Frage>();
                
                double punktzahl = 0.0;
                int frageNummer = 1;
                DateTime startZeit = DateTime.Now;
                DateTime endZeit = startZeit.AddMinutes(90); // 1,5 Stunden

                Console.ForegroundColor = ConsoleColor.Red;
                Console.WriteLine("\nğŸ“ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
                Console.WriteLine("   PRÃœFUNGSSIMULATION GESTARTET!");
                Console.WriteLine("   Zeitlimit: 1,5 Stunden (90 Minuten)");
                Console.WriteLine("   Keine Pausen - wie bei echtem Examen");
                Console.WriteLine("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
                Console.ResetColor();
                Console.WriteLine("\nâ° DrÃ¼cke Enter um zu starten...");
                Console.ReadLine();

                foreach (var frage in fragen)
                {
                    // PrÃ¼fe verbleibende Zeit
                    TimeSpan verbleibend = endZeit - DateTime.Now;
                    
                    if (verbleibend.TotalSeconds <= 0)
                    {
                        SpieleSignalTon();
                        Console.ForegroundColor = ConsoleColor.Red;
                        Console.WriteLine("\n\nâ° â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
                        Console.WriteLine("   ZEIT ABGELAUFEN!");
                        Console.WriteLine("   Das Examen ist beendet.");
                        Console.WriteLine("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
                        Console.ResetColor();
                        break;
                    }

                    // Zeige Frage mit Zeitanzeige
                    Console.WriteLine($"\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
                    Console.ForegroundColor = ConsoleColor.Yellow;
                    Console.WriteLine($"ğŸ“ Frage {frageNummer}/{fragen.Count} | â±ï¸  Verbleibend: {verbleibend.Hours}h {verbleibend.Minutes}min {verbleibend.Seconds}s");
                    Console.ResetColor();
                    Console.WriteLine(frage.FrageText);

                    if (frage.Typ == "MultipleChoice")
                    {
                        for (int i = 0; i < frage.Antworten.Count; i++)
                        {
                            Console.WriteLine($"   {i + 1}) {frage.Antworten[i]}");
                        }
                        
                        Console.Write("\nâ¡ï¸  Deine Antwort (z.B. 1 oder 1,2): ");
                        var eingabe = Console.ReadLine() ?? string.Empty;

                        var antworten = eingabe.Split(',', StringSplitOptions.RemoveEmptyEntries)
                            .Select(s => int.TryParse(s.Trim(), out int val) ? val - 1 : -1)
                            .Where(i => i >= 0)
                            .ToList();

                        if (PruefeMultipleChoice(frage, antworten))
                        {
                            Console.ForegroundColor = ConsoleColor.Green;
                            Console.WriteLine("âœ… Richtig!");
                            Console.ResetColor();
                            punktzahl++;
                        }
                        else
                        {
                            Console.ForegroundColor = ConsoleColor.Red;
                            Console.WriteLine("âŒ Falsch!");
                            Console.ResetColor();
                            Console.WriteLine("âœ”ï¸  Richtige Antwort(en): " + 
                                string.Join(", ", frage.RichtigeAntworten.Select(i => (i + 1).ToString())));
                        }
                    }
                    else if (frage.Typ == "Offen")
                    {
                        Console.Write("\nâœï¸  Deine Antwort: ");
                        var userAntwort = Console.ReadLine() ?? string.Empty;
                        double score = PruefeOffeneFrage(userAntwort, frage.RichtigeAntwort);

                        if (score >= 0.8)
                        {
                            Console.ForegroundColor = ConsoleColor.Green;
                            Console.WriteLine("âœ… VollstÃ¤ndig korrekt!");
                            Console.ResetColor();
                            punktzahl++;
                        }
                        else if (score >= 0.5)
                        {
                            Console.ForegroundColor = ConsoleColor.Yellow;
                            Console.WriteLine("ğŸŸ¡ Teilweise korrekt (0.5 Punkte).");
                            Console.ResetColor();
                            punktzahl += 0.5;
                        }
                        else
                        {
                            Console.ForegroundColor = ConsoleColor.Red;
                            Console.WriteLine("âŒ Leider falsch.");
                            Console.ResetColor();
                            Console.WriteLine("ğŸ’¡ Erwartete SchlÃ¼sselbegriffe: " + frage.RichtigeAntwort);
                        }
                    }

                    frageNummer++;
                }

                benutzer.Punktestand = punktzahl;
                TimeSpan gesamtZeit = DateTime.Now - startZeit;
                
                SpieleSignalTon();
                Console.WriteLine("\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
                Console.ForegroundColor = ConsoleColor.Cyan;
                Console.WriteLine($"ğŸ Examen beendet! {benutzer.Name}, du hast {punktzahl:0.0} von {fragen.Count} Punkten erreicht.");
                Console.WriteLine($"â±ï¸  BenÃ¶tigte Zeit: {gesamtZeit.Hours}h {gesamtZeit.Minutes}min {gesamtZeit.Seconds}s");
                Console.ResetColor();
            }
            catch (Exception ex)
            {
                Console.ForegroundColor = ConsoleColor.Red;
                Console.WriteLine($"âŒ Fehler beim Laden der Fragen: {ex.Message}");
                Console.ResetColor();
            }
        }
        {
            try
            {
                string basePath = AppDomain.CurrentDomain.BaseDirectory;
                string pfad = Path.Combine(basePath, "question.json");
                
                Console.WriteLine($"\nğŸ” Lade Fragen aus: {pfad}");
                List<Frage> fragen = JsonConvert.DeserializeObject<List<Frage>>(File.ReadAllText(pfad)) ?? new List<Frage>();
                
                double punktzahl = 0.0;
                int frageNummer = 1;

                foreach (var frage in fragen)
                {
                    Console.WriteLine($"\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
                    Console.ForegroundColor = ConsoleColor.Yellow;
                    Console.WriteLine($"ğŸ“ Frage {frageNummer}/{fragen.Count}:");
                    Console.ResetColor();
                    Console.WriteLine(frage.FrageText);

                    if (frage.Typ == "MultipleChoice")
                    {
                        for (int i = 0; i < frage.Antworten.Count; i++)
                        {
                            Console.WriteLine($"   {i + 1}) {frage.Antworten[i]}");
                        }
                        
                        Console.Write("\nâ¡ï¸  Deine Antwort (z.B. 1 oder 1,2): ");
                        var eingabe = Console.ReadLine() ?? string.Empty;

                        var antworten = eingabe.Split(',', StringSplitOptions.RemoveEmptyEntries)
                            .Select(s => int.TryParse(s.Trim(), out int val) ? val - 1 : -1)
                            .Where(i => i >= 0)
                            .ToList();

                        if (PruefeMultipleChoice(frage, antworten))
                        {
                            Console.ForegroundColor = ConsoleColor.Green;
                            Console.WriteLine("âœ… Richtig!");
                            Console.ResetColor();
                            punktzahl++;
                        }
                        else
                        {
                            Console.ForegroundColor = ConsoleColor.Red;
                            Console.WriteLine("âŒ Falsch!");
                            Console.ResetColor();
                            Console.WriteLine("âœ”ï¸  Richtige Antwort(en): " + 
                                string.Join(", ", frage.RichtigeAntworten.Select(i => (i + 1).ToString())));
                        }
                    }
                    else if (frage.Typ == "Offen")
                    {
                        Console.Write("\nâœï¸  Deine Antwort: ");
                        var userAntwort = Console.ReadLine() ?? string.Empty;
                        double score = PruefeOffeneFrage(userAntwort, frage.RichtigeAntwort);

                        if (score >= 0.8)
                        {
                            Console.ForegroundColor = ConsoleColor.Green;
                            Console.WriteLine("âœ… VollstÃ¤ndig korrekt!");
                            Console.ResetColor();
                            punktzahl++;
                        }
                        else if (score >= 0.5)
                        {
                            Console.ForegroundColor = ConsoleColor.Yellow;
                            Console.WriteLine("ğŸŸ¡ Teilweise korrekt (0.5 Punkte).");
                            Console.ResetColor();
                            punktzahl += 0.5;
                        }
                        else
                        {
                            Console.ForegroundColor = ConsoleColor.Red;
                            Console.WriteLine("âŒ Leider falsch.");
                            Console.ResetColor();
                            Console.WriteLine("ğŸ’¡ Erwartete SchlÃ¼sselbegriffe: " + frage.RichtigeAntwort);
                        }
                    }

                    frageNummer++;
                }

                benutzer.Punktestand = punktzahl;
                Console.WriteLine("\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
                Console.ForegroundColor = ConsoleColor.Cyan;
                Console.WriteLine($"ğŸ Quiz beendet! {benutzer.Name}, du hast {punktzahl:0.0} von {fragen.Count} Punkten erreicht.");
                Console.ResetColor();
            }
            catch (Exception ex)
            {
                Console.ForegroundColor = ConsoleColor.Red;
                Console.WriteLine($"âŒ Fehler beim Laden der Fragen: {ex.Message}");
                Console.ResetColor();
            }
        }

        static bool PruefeMultipleChoice(Frage frage, List<int> benutzerAntworten)
        {
            if (benutzerAntworten == null || benutzerAntworten.Count == 0) 
                return false;
            
            if (benutzerAntworten.All(a => frage.RichtigeAntworten.Contains(a)) && 
                benutzerAntworten.Count == frage.RichtigeAntworten.Count)
                return true;
            
            return false;
        }

        static double PruefeOffeneFrage(string benutzerAntwort, string richtigeAntwort)
        {
            benutzerAntwort = (benutzerAntwort ?? "").ToLower().Trim();
            richtigeAntwort = (richtigeAntwort ?? "").ToLower().Trim();

            var schluesselwoerter = richtigeAntwort.Split(' ')
                .Select(w => w.Trim(new[] { ',', '.', ';', ':', '!', '?', '(', ')' }))
                .Where(w => w.Length > 3)
                .Distinct()
                .ToList();

            if (schluesselwoerter.Count == 0) 
                return 0;
            
            int treffer = schluesselwoerter.Count(w => benutzerAntwort.Contains(w));
            return (double)treffer / schluesselwoerter.Count;
        }

        static List<Benutzer> LadeScores()
        {
            try
            {
                if (!File.Exists(ScoresFile)) 
                    return new List<Benutzer>();
                
                return JsonConvert.DeserializeObject<List<Benutzer>>(File.ReadAllText(ScoresFile)) 
                    ?? new List<Benutzer>();
            }
            catch
            {
                return new List<Benutzer>();
            }
        }

        static void SpeichereScores(List<Benutzer> scores)
        {
            try
            {
                File.WriteAllText(ScoresFile, JsonConvert.SerializeObject(scores, Formatting.Indented));
            }
            catch (Exception ex)
            {
                Console.ForegroundColor = ConsoleColor.Red;
                Console.WriteLine($"âŒ Fehler beim Speichern: {ex.Message}");
                Console.ResetColor();
            }
        }

        static void ZeigeHighscores(List<Benutzer> scores)
        {
            Console.WriteLine("\nğŸ† â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
            Console.WriteLine("       Highscores - Top 10");
            Console.WriteLine("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
            
            var top = scores.OrderByDescending(s => s.Punktestand)
                           .ThenBy(s => s.Name)
                           .Take(10)
                           .ToList();
            
            if (top.Count == 0)
            {
                Console.ForegroundColor = ConsoleColor.Yellow;
                Console.WriteLine("â„¹ï¸  Keine Scores vorhanden.");
                Console.ResetColor();
                return;
            }

            int rang = 1;
            foreach (var s in top)
            {
                string medal = rang == 1 ? "ğŸ¥‡" : rang == 2 ? "ğŸ¥ˆ" : rang == 3 ? "ğŸ¥‰" : "  ";
                Console.WriteLine($"{medal} {rang}. {s.Name} - {s.Punktestand:0.0} Punkte ({s.Datum})");
                rang++;
            }
        }

        static void PauseUndLoesche()
        {
            Console.WriteLine("\nâ¸ï¸  DrÃ¼cke Enter zum ZurÃ¼ckkehren zum MenÃ¼...");
            Console.ReadLine();
            Console.Clear();
            ZeigeHeader();
        }

        static bool LasseTimerLaufen(int sekunden, string phase)
        {
            DateTime startZeit = DateTime.Now;
            DateTime endZeit = startZeit.AddSeconds(sekunden);

            while (DateTime.Now < endZeit)
            {
                TimeSpan verbleibend = endZeit - DateTime.Now;
                
                // Zeige verbleibende Zeit
                Console.Write($"\râ±ï¸  [{phase}] Verbleibende Zeit: {verbleibend.Minutes:00}:{verbleibend.Seconds:00}  ");
                
                // PrÃ¼fe, ob Benutzer abbrechen mÃ¶chte
                if (Console.KeyAvailable)
                {
                    var taste = Console.ReadKey(intercept: true).Key;
                    if (taste == ConsoleKey.Escape || taste == ConsoleKey.Q)
                    {
                        Console.WriteLine("\n\nâ›” Timer abgebrochen.");
                        return false;
                    }
                }
                
                Thread.Sleep(1000); // 1 Sekunde warten
            }
            
            Console.WriteLine("\râ±ï¸  [" + phase + "] Verbleibende Zeit: 00:00  ");
            return true;
        }

        static void SpieleSignalTon()
        {
            try
            {
                // Spiele einen Signalton (funktioniert auf Windows)
                if (Environment.OSVersion.Platform == PlatformID.Win32NT)
                {
                    Console.Beep(800, 200);  // Ton 1
                    Thread.Sleep(100);
                    Console.Beep(1000, 200); // Ton 2
                    Thread.Sleep(100);
                    Console.Beep(1200, 300); // Ton 3
                }
                else
                {
                    Console.Write("\a"); // Terminal-Bell fÃ¼r andere Systeme
                }
            }
            catch
            {
                // Falls Beep nicht unterstÃ¼tzt wird, zeige nur visuelles Signal
                Console.Write("\a"); // Terminal-Bell
            }
        }
    }
}